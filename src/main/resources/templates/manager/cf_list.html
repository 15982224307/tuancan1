<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <!-- Bootstrap Styles-->
    <link href="/assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FontAwesome Styles-->
    <link href="/assets/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom Styles-->
    <link href="/assets/css/custom-styles.css" rel="stylesheet" />
    <!-- Google Fonts-->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /> 
     
</head>

<body>
    <div id="wrapper">
        <nav class="navbar navbar-default top-navbar" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html"><i class="fa fa-gear"></i> <strong>HYBRID</strong></a>
            </div>

            <ul class="nav navbar-top-links navbar-right top_right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-envelope fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Doe</strong>
                                    <span class="pull-right text-muted">
                                        <em>Today</em>
                                    </span>
                                </div>
                                <div>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem Ipsum has been the industry's standard dummy text ever since an kwilnw...</div>
                            </a>
                        </li>

                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>

                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 min</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 min</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>

                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 min</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down  top_right"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="#"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
        </nav>
        <!--/. NAV TOP  -->
        <nav class="navbar-default navbar-side" role="navigation">
		<div id="sideNav" href=""><i class="fa fa-caret-right"></i></div>
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">

                    <li>
                        <a href="ui-elements.html"><i class="fa fa-desktop"></i>用餐单位</a>
                        <ul class="nav nav-second-level">
                            <li class="">
                                <a href="" th:href="@{/groupMealUnit/yes_list}">用餐单位列表<span class="fa "></span></a>
                            </li>
                            <li>
                                <a href="" th:href="@{/groupMealUnit/no_list}">未审核列表<span class="fa arrow"></span></a>
                            </li>

                        </ul>
                    </li>

                    <li>
                        <a href="#"><i class="fa fa-desktop"></i>团餐机构</a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href=""  th:href="@{/deliveringCompany/yes_list}" >团餐机构列表</a>
                            </li>

                            <li>
                                <a href="" th:href="@{/deliveringCompany/no_list}" >未审核列表</a>
                            </li>
                        </ul>
                    </li>
					<li class="active">
                        <a href=""><i class="fa fa-bar-chart-o"></i>菜系管理</a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href=""  th:href="@{/recipeType/list}" >菜谱类型列表</a>
                            </li>
                            <li>
                                <a  th:href="@{/mainCategorie/list}">食材一级分类</a>
                            </li>
                            <li>
                                <a  href="javascript:void(0);" >食材二级分类</a>
                            </li>
                            <li>
                                <a href="" th:href="@{/foodMaterial/list}" >食材管理</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="tab-panel.html"><i class="fa fa-qrcode"></i> Tabs & Panels</a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href=""  th:href="@{/yes_list}" >列表</a>
                            </li>

                        </ul>
                    </li>
                    
                    <li>
                        <a href="table.html"><i class="fa fa-table"></i>权限设置</a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="#">设置团餐机构等级</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="form.html"><i class="fa fa-edit"></i> 处理投诉 </a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="#">投诉列表</a>
                            </li>
                            <li>
                                <a href="#">未处理列表</a>
                            </li>
                        </ul>
                    </li>


                    <li>
                        <a href="#"><i class="fa fa-sitemap"></i> 查询配送<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="#">xxxx</a>
                            </li>
                            <li>
                                <a href="#">xxx</a>
                            </li>
                            <li>
                                <a href="#">sanji<span class="fa arrow"></span></a>
                                <ul class="nav nav-third-level">
                                    <li>
                                        <a href="#">Third Level Link</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Link</a>
                                    </li>
                                    <li>
                                        <a href="#">Third Level Link</a>
                                    </li>

                                </ul>

                            </li>
                        </ul>
                    </li>

                </ul>

            </div>

        </nav>
        <!-- /. NAV SIDE  -->


        <div id="page-wrapper">
            <div id="page-inner">
                <div class="row">
                    <div class="col-md-12">


						<ul class="breadcrumb" >
                            <i style="text-align: left">团餐机构列表</i>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">团餐机构</a></li>
                                <li class="active">团餐机构列表</li>

                        </ul>

                        <ul class="top_search">


                            <div class="container-fluid">


                                    <div class="span12">
                                     <div class="row-fluid">
                                         <form class="">
                                             按分类名称查询： <input class="input-medium search-query" type="text" id="cfname"/>
                                             &nbsp;&nbsp;&nbsp;<button id="search" class="btn btn-primary" type="button">查询</button>
                                             <button id="add_type" data-toggle="modal" data-target="#myModal" class="btn btn-primary" type="button">添加</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </ul>


                        <div class="text_data" >
                            <div id="searchtable">
                            <table  class="table_shadow table table-bordered table-striped table-hover ">
                                <thead>
                                <tr>
                                    <th scope="">序号</th>
                                    <th  scope="">食材分类名称</th>
                                    <th>所属分类</th>
                                    <th scope="">操作 </th>

                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="cf,stat : ${page.list}" th:if="${not #lists.isEmpty(page.list)}">
                                    <td th:text="${stat.count+(pageNum-1)*10}"></td>
                                    <td th:text="${cf.classificationName}"></td>
                                    <td th:text="${cf.cascadeType.maincategorieName}"></td>

                                    <td>
                                        <button data-toggle="modal" data-target="#myModal" type="button" class="updatetype btn btn-xs btn-primary"
                                                th:onclick="'updatetype('+${cf.classificationId}+','+${cf.cascadeType.maincategorieId}+',\''+${cf.classificationName}+'\')'"><i class="fa fa-edit "></i>&nbsp;修改&nbsp;&nbsp;</button>

                                    </td>
                                </tr>
                                </tbody>
                            </table>

                            <!--分页栏位-->
                            <div th:include="manager/page::page"></div>
                            </div>

                        </div>
                    </div>
                </div>


            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
        <!--<div class="foot_div">-->
            <!--<p>Copyright &copy; 2016.Company name All rights reserved.More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></p>-->

        <!--</div>-->

    </div>
    <!-- 添加分类型的表单页面-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        添加食材分类
                    </h4>
                </div>
                <div class="modal-body">
                    <form  role="form" id="formdata">
                        <input type="hidden" name="classificationId" value="" id="cfId">
                        <div class="form-group">
                            <label>上级分类</label>
                            <select class="form-control" name="cascadeType.maincategorieId" id="modal_type">

                            </select>
                        </div>
                        <div class="form-group">
                            <label>名称</label>
                            <input type="text" id="modal_name" name="classificationName" class="form-control" placeholder="请输入名称">
                        </div>
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button id="confirm_commit" type="button" class="btn btn-primary">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <div class="modal fade" id="warning" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="warnlabel">
                        友情提示！不能为空
                    </h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">关闭
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <!-- /. WRAPPER  -->
    <!-- JS Scripts-->
    <!-- jQuery Js -->
    <script src="/webjars/jquery/3.3.0/jquery.js"></script>
    <!-- Bootstrap Js -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!--<script src="/webjars/bootstrap/4.1.1/js/bootstrap.js"></script>-->
    <!-- Metis Menu Js -->
    <script src="/assets/js/jquery.metisMenu.js"></script>

    <!-- Custom Js -->
    <script src="/assets/js/custom-scripts.js"></script>

    <script type="text/javascript">
        $('#search').click(function () {

            var cfname=$.trim($("#cfname").val());
            if(cfname==null||cfname==""){
               //alert("不能为空");
                $('#warning').modal('show');
               return;
            }
            $.ajax({
                url:"/classification/search/"+cfname,
                type:"POST",
                data:{
                    'asyc':true,
                },
                error:function (error) {
                    ("#warnlabel").text("糟糕！网络错误,请稍后再试");
                    $('#warning').modal('show');
                },
                success:function (result) {
                    //alert("ok");
                    $("#searchtable").html(result);
                },
            });

        });
        function updatetype(cfid,mainid,cfname) {
            $('#myModalLabel').text("更新分类");
            //清空上级分类
            $('#modal_type').find("option").remove();
            //查询上级分类
            $.ajax({
                url:"/mainCategorie/getAll",
                type:"POST",
                data:{},
                success:function (data) {
                    $.each(data,function (index,i) {
                        console.log(data[index]);
                        //var option=document.createElement("option");
                        if(mainid==i.maincategorieId){
                            $('#modal_type').append("<option selected value='"+i.maincategorieId+"'>"+i.maincategorieName+"</option>");

                        }else {
                            $('#modal_type').append("<option value='"+i.maincategorieId+"'>"+i.maincategorieName+"</option>");
                        }
                    })
                },
                error:function (error) {
                   // alert("网络错误");
                    $("#warnlabel").text("糟糕！网络错误,请稍后再试");
                    $('#warning').modal('show');
                }
            });
            //$('#modal_type')
            $('#cfId').val(cfid);
            $('#modal_name').val(cfname);
        };
        $(function () {
            /*搜索回显*/
            var url=window.location.href;
            var arr=url.split("/");
            if (arr.length==7){
                //alert(decodeURI(decodeURI(arr[5])));
                $("#cfname").val(decodeURI(decodeURI(arr[5])));
            }
            /*添加*/
            $('#add_type').click(function () {
                $('#myModalLabel').text("添加分类");
                //查询上级分类
                $.ajax({
                    url:"/mainCategorie/getAll",
                    type:"POST",
                    data:{},
                    success:function (data) {
                        $.each(data,function (index,i) {
                           // console.log(data[index]);
                            //var option=document.createElement("option");
                            $('#modal_type').append("<option value='"+i.maincategorieId+"'>"+i.maincategorieName+"</option>");
                        })
                    },
                    error:function (error) {
                        //alert("网络错误");
                        $("#warnlabel").text("糟糕！网络错误");
                        $('#warning').modal('show');
                    }
                });
            });

            //模态框完全对隐藏时触发。
            $('#myModal').on('hidden.bs.modal', function () {
                // 执行一些动作...
                //清空上级分类
                $('#modal_type').find("option").remove();
                $('#cfId').val('');
                $('#modal_name').val('');
            });
            $('#warning').on('hidden.bs.modal', function () {
                // 执行一些动作...
                $("#warnlabel").text("友情提示！不能为空");
            });

            $('#confirm_commit').click(function () {
                var name=$.trim($('#modal_name').val());
                var type=$.trim($('#modal_type').val());
                if(name==""||type==""){
                    $('#warning').modal('show');
                    return;
                }
                var savedata = $('#formdata').serialize();
                $.ajax({
                    url: "/classification/save",
                    type: "POST",
                    data: savedata,
                    error: function (error) {
                        //alert("网络错误");
                        $("#warnlabel").text("糟糕！网络错误");
                        $('#warning').modal('show');
                    },
                    success: function (result) {
                        //alert("添加成功");
                        $("#warnlabel").text("操作成功");
                        $('#warning').modal('show');
                        $('#myModal').modal('hide');
                    }
                });

            });
        });
    </script>
 

</body>

</html>