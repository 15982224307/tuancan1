<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link href="/assets/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
    <link href="/assets/css/zTreeStyle/metroStyle.css" rel="stylesheet">
    <!-- Bootstrap Styles-->
    <link href="/assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FontAwesome Styles-->
    <link href="/assets/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom Styles-->
    <link href="/assets/css/custom-styles.css" rel="stylesheet" />
    <!-- Google Fonts-->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' /> 
     
</head>

<body>
    <div id="wrapper">
        <nav class="navbar navbar-default top-navbar" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html"><i class="fa fa-gear"></i> <strong>HYBRID</strong></a>
            </div>

            <ul class="nav navbar-top-links navbar-right top_right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-envelope fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Doe</strong>
                                    <span class="pull-right text-muted">
                                        <em>Today</em>
                                    </span>
                                </div>
                                <div>Lorem Ipsum has been the industry's standard dummy text ever since the 1500s...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem Ipsum has been the industry's standard dummy text ever since an kwilnw...</div>
                            </a>
                        </li>

                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>

                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 min</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 min</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>

                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 min</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down  top_right"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="#"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
        </nav>
        <!--/. NAV TOP  -->
        <nav class="navbar-default navbar-side" role="navigation">
		<div id="sideNav" href=""><i class="fa fa-caret-right"></i></div>
            <div class="sidebar-collapse">
                <ul class="nav" id="main-menu">

                    <li>
                        <a href="ui-elements.html"><i class="fa fa-desktop"></i>用餐单位<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li class="">
                                <a href="" th:href="@{/groupMealUnit/yes_list}">用餐单位列表<span class="fa"></span></a>
                            </li>
                            <li>
                                <a href="" th:href="@{/groupMealUnit/no_list}">未审核列表<span class="fa arrow"></span></a>
                            </li>

                        </ul>
                    </li>

                    <li>
                        <a href="#"><i class="fa fa-desktop"></i>团餐机构</a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href=""  th:href="@{/deliveringCompany/yes_list}" >团餐机构列表<span class="fa arrow"></span></a>
                            </li>

                            <li>
                                <a href="" th:href="@{/deliveringCompany/no_list}" >未审核列表<span class="fa arrow"></span></a>
                            </li>
                        </ul>
                    </li>
					<li class="active">
                        <a href=""><i class="fa fa-bar-chart-o"></i>菜系管理<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href=""  th:href="@{/recipeType/list}" >菜谱类型列表<span class="fa arrow"></span></a>
                            </li>
                            <li>
                                <a href="" th:href="@{/mainCategorie/list}" >食材一级分类<span class="fa arrow"></span></a>
                            </li>
                            <li>
                                <a href="" th:href="@{/classification/list}" >食材二级分类<span class="fa arrow"></span></a>
                            </li>
                            <li>
                                <a href="javascript:void(0);"  >食材管理<span class="fa arrow"></span></a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="table.html"><i class="fa fa-table"></i>权限设置<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="#">设置团餐机构等级</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="form.html"><i class="fa fa-edit"></i> 处理投诉<span class="fa arrow"></span> </a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="" th:href="@{/complaint/yes_list}">投诉列表<span class="fa arrow"></span></a>
                            </li>
                            <li>
                                <a href="#" th:href="@{/complaint/no_list}">未处理列表<span class="fa arrow"></span></a>
                            </li>
                        </ul>
                    </li>


                    <li>
                        <a href="#"><i class="fa fa-sitemap"></i> 查询配送<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="#" th:href="@{/deliveringMaster/list}">配送详情<span class="fa arrow"></span></a>
                            </li>

                            <li>
                                <a href="#">sanji<span class="fa arrow"></span></a>
                                <ul class="nav nav-third-level">
                                    <li>
                                        <a href="" th:href="@{/deliveringMaster/unitlist}">用餐单位查询配送</a>
                                    </li>
                                    <li>
                                        <a href="" th:href="@{/deliveringMaster/deliverlist}">团餐餐单位查询配送</a>
                                    </li>
                                    <li>
                                        <a href="" th:href="@{/deliveringMaster/deliverlist}">获取明日菜单</a>
                                    </li>
                                    <li>
                                        <a href="" th:href="@{/deliveringMaster/deliverlist}">拟定合同</a>
                                    </li>
                                </ul>

                            </li>
                        </ul>
                    </li>

                </ul>

            </div>

        </nav>
        <!-- /. NAV SIDE  -->


        <div id="page-wrapper">
            <div id="page-inner">
                <div class="row">
                    <div class="col-md-12">


						<ul class="breadcrumb" >
                            <i style="text-align: left">食材列表</i>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">菜系管理</a></li>
                                <li class="active">食材列表</li>

                        </ul>

                        <ul class="top_search">


                            <div class="container-fluid">


                                    <div class="span12">
                                     <div class="row-fluid">
                                         <form class="">
                                             按食材名称查询： <input class="input-medium search-query" type="text" id="maname"/>
                                             &nbsp;&nbsp;&nbsp;<button id="search" class="btn btn-primary" type="button">查询</button>
                                             <button  data-toggle="modal" data-target="#myModal" id="add_type" type="button" class="btn btn-primary">添加</button>

                                         </form>
                                    </div>
                                </div>
                            </div>
                        </ul>


                        <div class="text_data">
                            <div id="searchtable">
                            <table  class="table_shadow table table-bordered table-striped table-hover ">
                                <thead>
                                <tr>
                                    <th scope="">序号</th>
                                    <th  scope="" style="width: 200px">食材名称</th>
                                    <th scope="">食材描述</th>
                                    <th scope="">食材图片</th>
                                    <th scope="">创建日期 </th>
                                    <th scope="">操作 </th>

                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="fm,stat : ${page.list}" th:if="${not #lists.isEmpty(page.list)}">
                                    <td th:text="${stat.count+(pageNum-1)*10}"></td>
                                    <td th:text="${fm.foodmaterialName}"></td>
                                    <td th:text="${fm.foodmaterialDisc}"></td>
                                    <td ><img th:src="${fm.foodmaterialIcon}" th:if="${fm.foodmaterialIcon!=''}"></td>
                                    <td th:text="${#dates.format(fm.foodmaterialCreatedate,'yyyy-MM-dd')}"></td>
                                    <td>
                                        <button data-toggle="modal" data-target="#myModal" type="button" class="updatetype btn btn-xs btn-primary"
                                                th:onclick="'updatetype('+${fm.foodmaterialId}+')'"><i class="fa fa-edit "></i>&nbsp;修改&nbsp;&nbsp;</button>
                                        <button data-toggle="modal" data-target="#uploadmodal" type="button" class="uploadbtn btn btn-xs btn-primary"
                                                th:onclick="'uploadpic('+${fm.foodmaterialId}+')'"><i class="fa fa-edit "></i>&nbsp;上传图片&nbsp;&nbsp;</button>

                                    </td>
                                </tr>
                                </tbody>
                            </table>

                            <!--分页栏位-->
                            <div th:include="manager/page::page"></div>

                            </div>

                        </div>
                    </div>
                </div>


            </div>
            <!-- /. PAGE INNER  -->
        </div>
        <!-- /. PAGE WRAPPER  -->
        <!--<div class="foot_div">-->
            <!--<p>Copyright &copy; 2016.Company name All rights reserved.More Templates <a href="http://www.cssmoban.com/" target="_blank" title="模板之家">模板之家</a> - Collect from <a href="http://www.cssmoban.com/" title="网页模板" target="_blank">网页模板</a></p>-->

        <!--</div>-->

    </div>
    <!-- 添加分类型的表单页面-->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" >
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        添加食材分类
                    </h4>
                </div>
                <div class="modal-body" style="height:250px ;">
                    <form  role="form" id="formdata" class="form-horizontal">
                        <input type="hidden" name="foodmaterialId" value="" id="fmId">
                        <div class="form-group">
                            <label for="modal_type" class="col-sm-2 control-label">上级分类</label>
                            <div class="col-sm-10">
                                    <input type="hidden" id="modal_id" name="classification.classificationId" >
                                    <input  class="form-control custom-input" id="modal_type" type="text"  value="请选择分类" style=" width:120px;"/>
                                    <div hidden id="ztreeDropdownContent" class="ztree-dropdown-content" style="display:none; position:absolute;z-index:999;height:300px; min-width:163px;
                             background-color:white;border:1px solid;overflow-y:auto;overflow-x:auto;">
                                        <ul id="partTree" class="ztree"></ul>
                                    </div>
                            </div>

                        </div>
                        <br>
                        <div class="form-group">
                            <label for="modal_name" class="col-sm-2 control-label">食材名称</label>
                            <div class="col-sm-10">
                            <input type="text" id="modal_name" name="foodmaterialName" class="form-control" placeholder="请输入名称">
                            </div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="modal_desc" class="col-sm-2 control-label">食材描述</label>
                            <div class="col-sm-10">
                                <input type="text" id="modal_desc" name="foodmaterialDisc" class="form-control" placeholder="请输入名称">
                            </div>
                        </div>
                        <br>

                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button id="confirm_commit" type="button" class="btn btn-primary">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

     <div class="modal fade" id="warning" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel1">
                        友情提示！不能为空
                    </h4>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">关闭
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

     <div class="modal fade" id="uploadmodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="uploadlabel">
                        上传食材图片
                    </h4>
                </div>
                <div class="modal-body">
                    <form id="uploadform" role="form" enctype="multipart/form-data" method="post" action= "javascript:void(0);" class="form-horizontal">
                        <input type="hidden" id="fmpicId" name="fmid" value="">
                        <div class="form-group">
                            <label for="modal_desc" class="col-sm-2 control-label">食材图片</label>
                            <div class="col-sm-10">
                                <input type="file" id="inputfile" name="picfile" class="form-control">
                            </div>
                        </div>
                        <br>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">关闭
                    </button>
                    <button id="uploadcommit" type="button" class="btn btn-primary">
                        上传
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>

    <!-- /. WRAPPER  -->
    <!-- JS Scripts-->
    <!-- jQuery Js -->
    <script src="/webjars/jquery/3.3.0/jquery.js"></script>

    <script type="text/javascript" src="/assets/js/jquery.ztree.core.js"></script>
    <!-- Bootstrap Js -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!--<script src="/webjars/bootstrap/4.1.1/js/bootstrap.js"></script>-->
    <!-- Metis Menu Js -->
    <script src="/assets/js/jquery.metisMenu.js"></script>

    <!-- Custom Js -->
    <script src="/assets/js/custom-scripts.js"></script>

    <script type="text/javascript">
        $('#search').click(function () {

            var name=$.trim($("#maname").val());
            console.log(name);
            if(name==null||name==""){
                $('#warning').modal('show');
                return;
            }
            //alert(formdata);
            $.ajax({
                url:"/foodMaterial/search/"+name,
                type:"POST",
                data:{
                    'asyc':true,
                },
                error:function (error) {

                },
                success:function (result) {
                    //alert("ok");
                    $("#searchtable").html(result);
                },
            });

        });
        /*上传图片*/
        function uploadpic(fmid) {
            $("#fmpicId").val(fmid);
        }
        $("#uploadcommit").click(function () {
            var file=$("#inputfile").val();
            console.log(file);
            var ext=file.split(".");
            console.log(ext[ext.length-1]);
            if($.trim(file)==""||!ext[ext.length-1]=="jpg"||!ext[ext.length-1]=="jpeg"||!ext[ext.length-1]=="png"){
                $("#myModalLabel1").text("友情提示！文件不能为空或者文件不是图片类型");
                $("#warning").modal("show");
                return;
            }
            var formdata=new FormData($("#uploadform")[0]);
            $.ajax({
                url:"/foodMaterial/upload",
                type:"POST",
                data:formdata,
                async:false,
                contentType:false,
                processData:false,
                success:function (data) {
                    alert(data.msg);
                    $('#uploadmodal').modal('hide');
                },
                error:function () {
                    alert("上传失败，网络故障");
                }
            });

        });
        function updatetype(id) {
            $('#myModalLabel').text("更新分类");

            $.ajax({
                url:"/foodMaterial/getone/"+id,
                type:"POST",
                data:{},
                success:function (data) {
                    $("#modal_id").val(data.classification.classificationId);
                    $('#modal_type').val(data.classification.classificationName);
                    $('#fmId').val(data.foodmaterialId);
                    $('#modal_name').val(data.foodmaterialName);
                    $('#modal_desc').val(data.foodmaterialDisc);
                },
                error:function (error) {
                    alert("网络错误，请稍后再试");
                }
            });
        };

        $(function () {
            /*树级菜单*/
            var setting={
                view: {
                    showLine: true,
                    showIcon:true,
                },
                //获取json数据
                async : {
                    enable : true,
                    url: "/foodMaterial/getTree", // Ajax 获取数据的 URL 地址
                    autoParam : [ "id", "name" ] //ajax提交的时候，传的是id值
                },
                callback:{
                    onAsyncError:function () {
                        alert("网络错误");
                    },
                    beforeClick:function (treeId, treeNode) {
                        var check = (treeNode && !treeNode.isParent);
                        if (!check){
                            alert("请选择下级分类");
                        }
                        return check;
                    },
                    onClick:function (event, treeId, treeNode) {
                        if(!treeNode.isParent){
                            $("#modal_id").val(treeNode.id);
                            alert(treeNode.name);
                            $("#modal_type").val(treeNode.name);
                            $("#modal_type").attr("readonly","true");
                            hideMenu();
                        }else {
                            var zTree = $.fn.zTree.getZTreeObj("partTree");
                            var node = zTree.getNodeByParam("id", $('#modal_id').val(), null);
                            zTree.selectNode(node);
                        }
                    }
                },
                data: {
                    simpleData: {
                        enable: true,
                        idKey: "id",
                        pIdKey: "pId",
                        rootPId: 0,
                    }
                },

            };
            function showMenu() {
                var cityObj = $("#partInput");
                var cityOffset = $("#partInput").offset();
                $("#ztreeDropdownContent").slideDown("fast");
                $("body").bind("mousedown", onBodyDown);
            }
            function hideMenu() {
                $("#ztreeDropdownContent").fadeOut("fast");
                $("body").unbind("mousedown", onBodyDown);
            }
            function onBodyDown(event) {
                if (!(event.target.id == "modal_type" || event.target.id == "ztreeDropdownContent" || $(event.target).parents("#ztreeDropdownContent").length>0)) {
                    hideMenu();
                }
            }

            $.fn.zTree.init($("#partTree"), setting);
            $("#modal_type").click(function(){
                showMenu();
            });

            $('#add_type').click(function () {
                $('#myModalLabel').text("添加分类");

            });


            //模态框完全对隐藏时触发。
            $('#myModal').on('hidden.bs.modal', function () {
                // 执行一些动作...
                //清空上级分类
                $("#modal_id").val('');
                $('#modal_type').val('')
                $('#fmId').val('');
                $('#modal_name').val('');
                $('#modal_desc').val('');

            });
            $('#warning').on('hidden.bs.modal', function () {
                // 执行一些动作...
                $("#myModalLabel1").text("友情提示！不能为空");
            });

            //模态框完全对隐藏时触发。
            $('#uploadmodal').on('hidden.bs.modal', function () {
                // 执行一些动作...
                $("#fmpicId").val('');
            });

            $('#confirm_commit').click(function () {
                var modal_id=$("#modal_id").val();
                var name=$('#modal_name').val();
                var desc=$('#modal_desc').val();
                if(modal_id==""||name==""){
                    $('#warning').modal('show');
                    return;
                }
                var savedata = $('#formdata').serialize();
                $.ajax({
                    url: "/foodMaterial/save",
                    type: "POST",
                    data: savedata,
                    error: function (error) {
                        alert("网络错误");
                    },
                    success: function (result) {
                        alert("添加成功");
                        $('#myModal').modal('hide');
                    }
                });
            });
                /*搜索回显*/
            var url=window.location.href;
            var arr=url.split("/");

            if (arr.length==7){
                $("#maname").val(decodeURI(decodeURI(arr[5])));
            }
        });
    </script>
 

</body>

</html>